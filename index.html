<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>To√°n Th·∫ßy H√† </title>

    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$','$$'], ['\\[','\\]']]
      }
    };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        .nav-btn { transition: background-color 0.2s, color 0.2s, border-color 0.2s; }
        .nav-btn-answered { background-color: #16a34a; color: white; border-color: #15803d; }
        .nav-btn-current { background-color: #4f46e5; color: white; border-color: #4338ca; transform: scale(1.05); }
        .mcq-label-selected { background-color: #e0e7ff; border-color: #6366f1; }
        @keyframes blinkingColors {
            0%,100% { color: #22c55e; } 33% { color: #ef4444; } 66% { color: #eab308; }
        }
        .blinking-text { animation: blinkingColors 3s infinite; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
    <div id="main-container" class="w-full max-w-4xl bg-white rounded-xl shadow-lg p-6">
        <h1 class="text-2xl font-bold text-center mb-6 blinking-text">L·ªõp To√°n Th·∫ßy H√†</h1>

        <div id="userInfoSection" class="max-w-md mx-auto">
	<div class="mb-4">
                <label class="block font-bold text-center text-blue-600">M√£ k·ª≥ thi (Ki·ªÉm tra)</label>
                <p id="examCodeDisplay" class="w-full text-center text-lg font-bold text-red-600 p-2 mt-1"></p>
            </div>
            <h2 class="text-xl font-bold text-center mb-4">Th√¥ng tin th√≠ sinh</h2>
            

            <div class="mb-3">
                <label class="block font-medium">S·ªë b√°o danh (VD: 530112)</label>
                <input type="text" id="studentId" class="w-full border rounded px-3 py-2 mt-1" required>
            </div>
            <div class="mb-3">
                <label class="block font-medium">H·ªç v√† t√™n (VD: Nguy·ªÖn VƒÉn H√†)</label>
                <input type="text" id="fullname" class="w-full border rounded px-3 py-2 mt-1" required>
            </div>
            <div class="mb-3">
                <label class="block font-medium">L·ªõp (VD: 11A1, 11A12)</label>
                <input type="text" id="className" class="w-full border rounded px-3 py-2 mt-1" required>
            </div>
            <div class="mb-3">
    	<label class="block font-medium">Tr∆∞·ªùng</label>
  	 <select id="schoolSelect" class="w-full border rounded px-3 py-2 mt-1">
        <option value="">-- Ch·ªçn tr∆∞·ªùng --</option>
        <option value="THPT Y√™n D≈©ng s·ªë 1">THPT Y√™n D≈©ng s·ªë 1</option>
        <option value="THPT Y√™n D≈©ng s·ªë 2">THPT Y√™n D≈©ng s·ªë 2</option>
        <option value="THPT Y√™n D≈©ng s·ªë 3">THPT Y√™n D≈©ng s·ªë 3</option>
        <option value="Cƒê ngh·ªÅ Vi·ªát ‚Äì H√†n BN">Cƒê ngh·ªÅ Vi·ªát ‚Äì H√†n BN</option>
        <option value="Kh√°c">Kh√°c...</option>
    	</select>
    	<input type="text" id="schoolInput" class="w-full border rounded px-3 py-2 mt-2 hidden" placeholder="Nh·∫≠p t√™n tr∆∞·ªùng kh√°c">
	</div>

            <button id="startBtn" class="w-full bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded mt-2">B·∫Øt ƒë·∫ßu l√†m b√†i</button>
        </div>

        <div id="quizSection" class="hidden">
            <div id="quiz-header" class="flex justify-between items-start border-b pb-4 mb-4">
                <div>
                    <h2 id="quiz-part-title" class="text-xl md:text-2xl font-bold text-gray-800"></h2>
                    <p class="text-lg font-semibold text-blue-600">
                        C√¢u <span id="question-counter">1</span> / <span id="total-questions-display"></span>
                    </p>
                </div>
                <div>
                    <div id="timer" class="text-2xl font-bold text-red-500">00:00</div>
                    <div id="timeHint" class="text-sm text-gray-500 text-right">Th·ªùi gian l√†m b√†i</div>
                </div>
            </div>

            <div id="questionNavPanel" class="flex flex-wrap gap-2 p-3 border-b mb-4 bg-gray-50 rounded-lg"></div>

            <form id="quizForm" class="space-y-6">
                <p id="question-text" class="text-lg font-medium text-gray-800 min-h-[48px]"></p>
                <div id="answer-container" class="space-y-3"></div>

                <div class="flex justify-between items-center pt-4 mt-4 border-t">
                    <button type="button" id="prevBtn" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-6 py-2 rounded">C√¢u tr∆∞·ªõc</button>
                    <div class="flex gap-3">
                        <button type="button" id="reviewTimeBtn" class="bg-yellow-400 hover:bg-yellow-500 text-white px-4 py-2 rounded">Xem b·ªô th·ªùi gian</button>
                        <button type="submit" id="submitBtn" class="bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded text-lg font-bold">N·ªôp b√†i</button>
                    </div>
                    <button type="button" id="nextBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded">C√¢u sau</button>
                </div>
            </form>
        </div>

        <div id="countdown" class="text-red-600 font-bold text-lg my-2"></div>

        <div id="resultSection" class="hidden text-center">
            <h2 id="studentNameResult" class="text-2xl font-bold mb-2"></h2>
            <p class="text-lg mb-4">ƒê√£ ho√†n th√†nh b√†i ki·ªÉm tra!</p>
            <p class="text-blue-600 font-bold text-lg my-2">T·ªïng ƒëi·ªÉm c·ªßa b·∫°n l√†: 
                <span id="finalScore" class="font-bold text-blue-600 text-3xl"></span>
            </p>
            <p class="mt-4 text-gray-600">K·∫øt qu·∫£ ƒë√£ ƒë∆∞·ª£c l∆∞u v√†o h·ªá th·ªëng.</p>
            <p class="text-red-600 font-bold text-lg my-2">Li√™n h·ªá 0988.948.882 ƒë·ªÉ tham gia l·ªõp h·ªçc!</p>

        </div>
    </div>

    <!-- Modal qu·∫£ng c√°o / x√°c nh·∫≠n v√†o thi -->
    <div id="announcementModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-xl shadow-lg p-8 max-w-lg w-full text-center">
            <h2 class="text-xl font-bold mb-2">L·ªõp to√°n th·∫ßy H√† ti·∫øp t·ª•c tuy·ªÉn sinh</h2>
            <p class="text-gray-600 mb-6">
                √în luy·ªán ki·∫øn th·ª©c c∆° b·∫£n v√† ki·∫øn th·ª©c chuy√™n s√¢u theo y√™u c·∫ßu!<br>
	   Ki·ªÉm tra, ƒë√°nh gi√°, nh·∫≠n x√©t ƒë·ªãnh k√¨ 2 l·∫ßn/th√°ng!<br>
                ƒê·ªãa ch·ªâ h·ªçc: ƒê·ªôi 6 - Xu√¢n Ph√∫ ‚Äì T√¢n Ti·∫øn ‚Äì B·∫Øc Ninh!<br>
                Li√™n h·ªá qua Zalo: <strong>0988.948.882</strong>
            </p>
            <div class="flex justify-center gap-4">
                <button id="enterQuizBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-8 py-2 rounded">V√†o thi</button>
                <button id="exitBtn" class="bg-red-500 hover:bg-red-600 text-white px-8 py-2 rounded">Tho√°t</button>
            </div>
        </div>
    </div>

    <!-- Modal confirm n·ªôp b√†i -->
    <div id="confirmSubmitModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-lg shadow-lg p-6 max-w-md w-full text-center">
            <h3 class="text-lg font-bold mb-3">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën n·ªôp b√†i kh√¥ng?</h3>
            <p class="mb-4 text-gray-600">Sau khi n·ªôp, b·∫°n kh√¥ng th·ªÉ s·ª≠a ƒë√°p √°n.</p>
            <div class="flex justify-center gap-4">
                <button id="confirmYes" class="bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded">Yes</button>
                <button id="confirmNo" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-6 py-2 rounded">No</button>	
            </div>
        </div>
    </div>

    <!-- Modal xem b·ªô th·ªùi gian -->
    <div id="timeInfoModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-lg shadow-lg p-6 max-w-md w-full">
            <h3 class="text-lg font-bold mb-3">B·ªô th·ªùi gian</h3>
            <p class="mb-2"><strong>M√£ k·ª≥ thi:</strong> <span id="modalExamCode"></span></p>
            <p class="mb-2"><strong>Gi·ªù m·ªü ƒë·ªÅ:</strong> <span id="modalStartTime"></span></p>
            <p class="mb-2"><strong>Gi·ªù ƒë√≥ng ƒë·ªÅ:</strong> <span id="modalDeadline"></span></p>
            <p class="mb-4 text-sm text-gray-600">Th·ªùi gian l√†m b√†i t√≠nh t·ª´ l√∫c b·∫°n nh·∫•n "V√†o thi".</p>
            <div class="text-right">
                <button id="closeTimeInfo" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">ƒê√≥ng</button>
            </div>
        </div>
    </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, query, where, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

// ====== C·∫•u h√¨nh Firebase ======
const firebaseConfig = {
    apiKey: "AIzaSyAwM9_H8PTooz3Nh4MPt9wdtBScIvMC318",
    authDomain: "toanthayha-cd96c.firebaseapp.com",
    projectId: "toanthayha-cd96c",
    storageBucket: "toanthayha-cd96c.firebasestorage.app",
    messagingSenderId: "940207284081",
    appId: "1:940207284081:web:9801158f72cc14053ae0d0",	
    measurementId: "G-9D5ZQ66BSB"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ====== C·∫•u h√¨nh k·ª≥ thi ====== timeend
const EXAM_CODE = "Toan11_002";
const QUIZ_ID = "toanthayha_11";
const TIME_LIMIT_SECONDS = 60 * 60; // th·ªùi gian l√†m b√†i (gi√¢y). ch·ªânh ·ªü ƒë√¢y
const ATTEMPT_LIMIT = 3;            // gi·ªõi h·∫°n s·ªë l·∫ßn l√†m b√†i m·ªói SBD
const START_TIME = "2025-10-09T20:00:00"; // th·ªùi gian m·ªü
const DEADLINE = "2025-10-18T23:00:00";   // th·ªùi gian ƒë√≥ng

// ====== DOM ======
const examCodeDisplay = document.getElementById("examCodeDisplay");
const startBtn = document.getElementById("startBtn");
const announcementModal = document.getElementById("announcementModal");
const enterQuizBtn = document.getElementById("enterQuizBtn");
const exitBtn = document.getElementById("exitBtn");
const userInfoSection = document.getElementById("userInfoSection");
const quizSection = document.getElementById("quizSection");
const resultSection = document.getElementById("resultSection");
const timerElement = document.getElementById("timer");
const countdownEl = document.getElementById("countdown");
const reviewTimeBtn = document.getElementById("reviewTimeBtn");

const confirmSubmitModal = document.getElementById("confirmSubmitModal");
const confirmYes = document.getElementById("confirmYes");
const confirmNo = document.getElementById("confirmNo");

const timeInfoModal = document.getElementById("timeInfoModal");
const modalExamCode = document.getElementById("modalExamCode");
const modalStartTime = document.getElementById("modalStartTime");
const modalDeadline = document.getElementById("modalDeadline");
const closeTimeInfo = document.getElementById("closeTimeInfo");

const quizForm = document.getElementById("quizForm");
const prevBtn = document.getElementById("prevBtn");
const nextBtn = document.getElementById("nextBtn");
const submitBtn = document.getElementById("submitBtn");
// X·ª≠ l√Ω ch·ªçn tr∆∞·ªùng
const schoolSelect = document.getElementById("schoolSelect");
const schoolInput = document.getElementById("schoolInput");

schoolSelect.addEventListener("change", () => {
    if (schoolSelect.value === "Kh√°c") {
        schoolInput.classList.remove("hidden");
        schoolInput.value = "";
    } else {
        schoolInput.classList.add("hidden");
        schoolInput.value = schoolSelect.value;
    }
});


// Hi·ªÉn th·ªã m√£ k·ª≥ thi
examCodeDisplay.textContent = EXAM_CODE;

// Hi·ªÉn th·ªã modal th√¥ng tin th·ªùi gian
modalExamCode.textContent = EXAM_CODE;
modalStartTime.textContent = (new Date(START_TIME)).toLocaleString();
modalDeadline.textContent = (new Date(DEADLINE)).toLocaleString();

reviewTimeBtn.addEventListener("click", () => timeInfoModal.classList.remove("hidden"));
closeTimeInfo.addEventListener("click", () => timeInfoModal.classList.add("hidden"));

// === Countdown m·ªü/ƒë√≥ng ƒë·ªÅ ===
function formatDiff(ms) {
    if (ms < 0) ms = 0;
    const totalSeconds = Math.floor(ms / 1000);
    const h = Math.floor(totalSeconds / 3600);
    const m = Math.floor((totalSeconds % 3600) / 60);
    const s = totalSeconds % 60;
    return `${h}h ${m}m ${s}s`;
}
function updateCountdown() {
    const now = new Date();
    const startDate = new Date(START_TIME);
    const endDate = new Date(DEADLINE);
    let msg = "";
    if (now < startDate) {
        msg = "‚è≥ B√†i ki·ªÉm tra s·∫Ω m·ªü sau: " + formatDiff(startDate - now);
    } else if (now >= startDate && now <= endDate) {
        msg = "üìù B√†i ki·ªÉm tra ƒëang m·ªü. H√£y l√†m th√™m l·∫ßn n·ªØa n·∫øu c√≤n l∆∞·ª£t. C√≤n th·ªùi gian t·ªõi khi ƒë√≥ng ƒë·ªÅ: " + formatDiff(endDate - now);
    } else {
        msg = "‚ùå B√†i ki·ªÉm tra ƒë√£ k·∫øt th√∫c.";
        startBtn.disabled = true;
        startBtn.textContent = "ƒê√£ h·∫øt h·∫°n l√†m b√†i";
        startBtn.classList.add('bg-gray-400','cursor-not-allowed');
    }
    countdownEl.textContent = msg;
}
setInterval(updateCountdown, 1000);
updateCountdown();

// nhapcauhoi
const originalQuizData = [{
"part": "Ph·∫ßn I: C√¢u tr·∫Øc nghi·ªám nhi·ªÅu ph∆∞∆°ng √°n l·ª±a ch·ªçn",
"type": "mcq",
"question": "Trong c√°c d√£y s·ªë sau, d√£y s·ªë n√†o l√† m·ªôt c·∫•p s·ªë c·ªông?",
"o": ["$1,\\,2,\\,4,\\,8,\\,16,...$ .", "$1,\\,3,\\,9,\\,27,\\,81,...$ .", "$2,\\,5,\\,8,\\,11,\\,14,\\,17,...$ .", "$-1,\\,-5,\\,-25,\\,-125,\\,-625,...$ ."],
"a": "$2,\\,5,\\,8,\\,11,\\,14,\\,17,...$ ."
},
{
"part": "Ph·∫ßn I: C√¢u tr·∫Øc nghi·ªám nhi·ªÅu ph∆∞∆°ng √°n l·ª±a ch·ªçn",
"type": "mcq",
"question": "Cho c·∫•p s·ªë c·ªông  $\\left( {{u}_{n}} \\right)$  c√≥ s·ªë h·∫°ng ƒë·∫ßu  ${{u}_{1}}=2$ , c√¥ng sai  $d=5$ . Gi√° tr·ªã c·ªßa ${{u}_{4}}$ b·∫±ng",
"o": ["$22$ .", "$17$ .", "$~12$ .", "$250$ ."],
"a": "$17$ ."
},
{
"part": "Ph·∫ßn I: C√¢u tr·∫Øc nghi·ªám nhi·ªÅu ph∆∞∆°ng √°n l·ª±a ch·ªçn",
"type": "mcq",
"question": "D√£y s·ªë $\\left( {{u}_{n}} \\right)$n√†o sau ƒë√¢y l√† d√£y s·ªë tƒÉng?",
"o": ["${{u}_{n}}={{3}^{-n}}+1$.", "${{u}_{n}}=\\sin n$.", "${{u}_{n}}=2n-3$.", "${{u}_{n}}=\\frac{n+2}{n+1}$."],
"a": "${{u}_{n}}=2n-3$."
},
{
"part": "Ph·∫ßn I: C√¢u tr·∫Øc nghi·ªám nhi·ªÅu ph∆∞∆°ng √°n l·ª±a ch·ªçn",
"type": "mcq",
"question": "Ba g√≥c c·ªßa m·ªôt tam gi√°c vu√¥ng t·∫°o th√†nh c·∫•p s·ªë c·ªông. Hai g√≥c nh·ªçn c·ªßa tam gi√°c c√≥ s·ªë ƒëo (ƒë·ªô) l√†",
"o": ["$20{}^\\circ $ v√† $70{}^\\circ .$", "$45{}^\\circ $ v√† $45{}^\\circ .$", "$20{}^\\circ $ v√† $45{}^\\circ .$", "$30{}^\\circ $ v√† $60{}^\\circ .$"],
"a": "$30{}^\\circ $ v√† $60{}^\\circ .$"
},
{
"part": "Ph·∫ßn I: C√¢u tr·∫Øc nghi·ªám nhi·ªÅu ph∆∞∆°ng √°n l·ª±a ch·ªçn",
"type": "mcq",
"question": "Cho m·ªôt c·∫•p s·ªë c·ªông c√≥ ${{u}_{3}}=-15$, ${{u}_{20}}=60$. T·ªïng c·ªßa $20$ s·ªë h·∫°ng ƒë·∫ßu ti√™n c·ªßa c·∫•p s·ªë c·ªông l√†",
"o": ["$200$.", "$250$.", "$-25$.", "$-200$."],
"a": "$250$."
},
{
"part": "Ph·∫ßn I: C√¢u tr·∫Øc nghi·ªám nhi·ªÅu ph∆∞∆°ng √°n l·ª±a ch·ªçn",
"type": "mcq",
"question": "Cho d√£y s·ªë $\\left( {{x}_{n}} \\right)$th·ªèa m√£n  ${{x}_{1}}+{{x}_{2}}+...+{{x}_{n}}=\\frac{3n\\left( n+3 \\right)}{2}$ v·ªõi m·ªçi  $n\\in \\mathbb{N}*$ . Kh·∫≥ng ƒë·ªãnh n√†o d∆∞·ªõi ƒë√¢y l√† ƒë√∫ng v√† ƒë·∫ßy ƒë·ªß nh·∫•t.",
"o": ["$\\left( {{x}_{n}} \\right)$l√† c·∫•p s·ªë c·ªông v·ªõi c√¥ng sai √¢m.", "$\\left( {{x}_{n}} \\right)$l√† c·∫•p s·ªë nh√¢n v·ªõi c√¥ng b·ªôi √¢m.", "$\\left( {{x}_{n}} \\right)$l√† c·∫•p s·ªë c·ªông v·ªõi c√¥ng sai d∆∞∆°ng.", "$\\left( {{x}_{n}} \\right)$l√† c·∫•p s·ªë nh√¢n v·ªõi c√¥ng b·ªôi d∆∞∆°ng."],
"a": "$\\left( {{x}_{n}} \\right)$l√† c·∫•p s·ªë c·ªông v·ªõi c√¥ng sai d∆∞∆°ng."
},
{
"part": "Ph·∫ßn I: C√¢u tr·∫Øc nghi·ªám nhi·ªÅu ph∆∞∆°ng √°n l·ª±a ch·ªçn",
"type": "mcq",
"question": "Cho c·∫•p s·ªë nh√¢n $\\left( {{u}_{n}} \\right)$ c√≥ ${{u}_{1}}\\ne 0$ v√† $q\\ne 0.$ ƒê·∫≥ng th·ª©c n√†o sau ƒë√¢y l√† ƒë√∫ng?",
"o": ["${{u}_{7}}={{u}_{4}}.{{q}^{3}}.$", "${{u}_{7}}={{u}_{4}}.{{q}^{4}}.$", "${{u}_{7}}={{u}_{4}}.{{q}^{5}}.$", "${{u}_{7}}={{u}_{4}}.{{q}^{6}}.$"],
"a": "${{u}_{7}}={{u}_{4}}.{{q}^{6}}.$"
},
{
"part": "Ph·∫ßn I: C√¢u tr·∫Øc nghi·ªám nhi·ªÅu ph∆∞∆°ng √°n l·ª±a ch·ªçn",
"type": "mcq",
"question": "Cho d√£y s·ªë  $\\left( {{u}_{n}} \\right)$  v·ªõi  ${{u}_{n}}=\\frac{3}{2}{{.5}^{n}}$ . Kh·∫≥ng ƒë·ªãnh n√†o sau ƒë√¢y ƒë√∫ng?",
"o": ["$\\left( {{u}_{n}} \\right)$  l√† c·∫•p s·ªë nh√¢n c√≥ c√¥ng b·ªôi  $q=5$  v√† s·ªë h·∫°ng ƒë·∫ßu  ${{u}_{1}}=\\frac{15}{2}$ .", "$\\left( {{u}_{n}} \\right)$  l√† c·∫•p s·ªë c·ªông c√≥ c√¥ng sai  $d=5$  v√† s·ªë h·∫°ng ƒë·∫ßu  ${{u}_{1}}=\\frac{3}{2}$ .", "$\\left( {{u}_{n}} \\right)$  l√† c·∫•p s·ªë nh√¢n c√≥ c√¥ng b·ªôi  $q=5$  v√† s·ªë h·∫°ng ƒë·∫ßu  ${{u}_{1}}=\\frac{3}{2}$ .", "$\\left( {{u}_{n}} \\right)$  kh√¥ng ph·∫£i l√† c·∫•p s·ªë nh√¢n."],
"a": "$\\left( {{u}_{n}} \\right)$  l√† c·∫•p s·ªë nh√¢n c√≥ c√¥ng b·ªôi  $q=5$  v√† s·ªë h·∫°ng ƒë·∫ßu  ${{u}_{1}}=\\frac{15}{2}$ ."
},
{
"part": "Ph·∫ßn I: C√¢u tr·∫Øc nghi·ªám nhi·ªÅu ph∆∞∆°ng √°n l·ª±a ch·ªçn",
"type": "mcq",
"question": "Cho c·∫•p s·ªë nh√¢n $\\left( {{u}_{n}} \\right)$ c√≥ ${{u}_{2}}=-6$ v√† ${{u}_{6}}=-486.$ T√¨m c√¥ng b·ªôi $q$ c·ªßa c·∫•p s·ªë nh√¢n ƒë√£ cho, bi·∫øt r·∫±ng ${{u}_{3}}<0$.",
"o": ["$q=-3.$", "$q=-\\frac{1}{3}.$", "$q=\\frac{1}{3}.$", "$q=3.$"],
"a": "$q=3.$"
},
{
"part": "Ph·∫ßn I: C√¢u tr·∫Øc nghi·ªám nhi·ªÅu ph∆∞∆°ng √°n l·ª±a ch·ªçn",
"type": "mcq",
"question": "Cho d√£y s·ªë $\\left( {{u}_{n}} \\right)$ x√°c ƒë·ªãnh b·ªüi ${{u}_{n}}=9-2n$. M·ªánh ƒë·ªÅ n√†o d∆∞·ªõi ƒë√¢y ƒë√∫ng?",
"o": ["$\\left( {{u}_{n}} \\right)$  l√† d√£y gi·∫£m v√† b·ªã ch·∫∑n tr√™n.", "$\\left( {{u}_{n}} \\right)$  tƒÉng.", "$\\left( {{u}_{n}} \\right)$  l√† d√£y gi·∫£m v√† b·ªã ch·∫∑n d∆∞·ªõi.", "$\\left( {{u}_{n}} \\right)$  b·ªã ch·∫∑n."],
"a": "$\\left( {{u}_{n}} \\right)$  l√† d√£y gi·∫£m v√† b·ªã ch·∫∑n tr√™n."
},
{
"part": "Ph·∫ßn II: C√¢u tr·∫Øc nghi·ªám ƒë√∫ng sai",
"type": "true-false",
"question": "Cho c·∫•p s·ªë c·ªông $\\left( {{u}_{n}} \\right)$ v·ªõi ${{u}_{1}}+{{u}_{3}}=6$ v√† $2{{u}_{2}}-{{u}_{4}}=-5$. ƒê·ªìng th·ªùi cho d√£y s·ªë d√£y s·ªë $\\left( {{v}_{n}} \\right)$ c√≥ s·ªë h·∫°ng t·ªïng qu√°t ${{v}_{n}}=u_{n}^{2}-16{{n}^{2}}$. X√©t t√≠nh ƒë√∫ng sai c·ªßa c√°c m·ªánh ƒë·ªÅ sau:",
"s": [
{"text": "S·ªë h·∫°ng ƒë·∫ßu c·ªßa c·∫•p s·ªë c·ªông $\\left( {{u}_{n}} \\right)$ l√† ${{u}_{1}}=3$.", "a": true},
{"text": "C√¥ng sai c·ªßa c·∫•p s·ªë c·ªông $\\left( {{u}_{n}} \\right)$ l√† m·ªôt s·ªë d∆∞∆°ng.", "a": false},
{"text": "T·ªïng c·ªßa 20 s·ªë h·∫°ng ƒë·∫ßu c·ªßa c·∫•p s·ªë c·ªông $\\left( {{u}_{n}} \\right)$ b·∫±ng $1480$.", "a": true},
{"text": "D√£y s·ªë $\\left( {{v}_{n}} \\right)$ l√† c·∫•p s·ªë c·ªông c√≥ c√¥ng sai l√† $d=-20$.", "a": true}
]
},
{
"part": "Ph·∫ßn II: C√¢u tr·∫Øc nghi·ªám ƒë√∫ng sai",
"type": "true-false",
"question": "Cho c·∫•p s·ªë c·ªông $\\left( {{u}_{n}} \\right)$, c√≥ s·ªë h·∫°ng ƒë·∫ßu ${{u}_{1}}=\\frac{3}{2}$, c√¥ng sai $d=\\frac{1}{2}$. Khi ƒë√≥ c√°c m·ªánh ƒë·ªÅ d∆∞·ªõi ƒë√¢y ƒë√∫ng hay sai ?",
"s": [
{"text": "C√¥ng th·ª©c s·ªë h·∫°ng t·ªïng qu√°t c·ªßa c·∫•p s·ªë c·ªông ƒë√£ cho l√† ${{u}_{n}}=1+\\frac{n}{3}$", "a": false},
{"text": "S·ªë 5 l√† s·ªë h·∫°ng th·ª© 8 c·ªßa c·∫•p s·ªë c·ªông ƒë√£ cho.", "a": true},
{"text": "S·ªë $\\frac{15}{4}$ l√† m·ªôt s·ªë h·∫°ng c·ªßa c·∫•p s·ªë c·ªông ƒë√£ cho.", "a": false},
{"text": "T·ªïng $100$ s·ªë h·∫°ng ƒë·∫ßu c·ªßa c·ªßa c·∫•p s·ªë c·ªông $({{u}_{n}})$ tr√™n b·∫±ng $2620$", "a": false}
]
},
{
"part": "Ph·∫ßn II: C√¢u tr·∫Øc nghi·ªám ƒë√∫ng sai",
"type": "true-false",
"question": "Cho d√£y s·ªë $\\left( {{u}_{n}} \\right)\\,$ th·ªèa m√£n ${{u}_{1}}=1,\\,\\,{{u}_{n+1}}={{u}_{n}}+n\\,\\forall n\\in {{\\mathbb{N}}^{*}}$",
"s": [
{"text": "D√£y s·ªë ƒë√£ cho l√† d√£y s·ªë tƒÉng.", "a": true},
{"text": "D√£y s·ªë ƒë√£ cho l√† d√£y s·ªë b·ªã ch·∫∑n.", "a": false},
{"text": "${{u}_{8}}=29$", "a": true},
{"text": "D√£y ƒë√£ cho l√† m·ªôt c·∫•p s·ªë c·ªông.", "a": false}
]
},
{
"part": "Ph·∫ßn III: C√¢u tr·∫Øc nghi·ªám tr·∫£ l·ªùi ng·∫Øn",
"type": "short-answer",
"question": "Ba s·ªë $a,b,c$ kh√°c $0$ theo th·ª© t·ª± ƒë√≥ l·∫≠p th√†nh m·ªôt c·∫•p s·ªë c·ªông c√≥ c√¥ng sai d∆∞∆°ng. N·∫øu c·ªông th√™m v√†o s·ªë h·∫°ng th·ª© ba 9 ƒë∆°n v·ªã th√¨ ta thu ƒë∆∞·ª£c d√£y s·ªë m·ªõi theo th·ª© t·ª± ƒë√≥ l·∫≠p th√†nh m·ªôt c·∫•p s·ªë nh√¢n. N·∫øu ta ti·∫øp t·ª•c nh√¢n s·ªë h·∫°ng th·ª© 2 v√† th·ª© 3 c·ªßa c·∫•p s·ªë nh√¢n n√†y v·ªõi $\\frac{-1}{8}$ ta l·∫°i thu ƒë∆∞·ª£c d√£y s·ªë m·ªõi theo th·ª© t·ª± ƒë√≥ l·∫≠p th√†nh c·∫•p s·ªë c·ªông. T√≠nh gi√° tr·ªã bi·ªÉu th·ª©c $P=a+2b+3c$.",
"a": "30"
},
{
"part": "Ph·∫ßn III: C√¢u tr·∫Øc nghi·ªám tr·∫£ l·ªùi ng·∫Øn",
"type": "short-answer",
"question": "Cho c·∫•p s·ªë nh√¢n $\\left( {{u}_{n}} \\right)$v·ªõi ${{u}_{1}}=2,\\,{{u}_{4}}=54.$ Gi√° tr·ªã c·ªßa s·ªë h·∫°ng th·ª© 8 b·∫±ng bao nhi√™u?",
"a": "4374"
},
{
"part": "Ph·∫ßn III: C√¢u tr·∫Øc nghi·ªám tr·∫£ l·ªùi ng·∫Øn",
"type": "short-answer",
"question": "Qu√° tr√¨nh ph√¢n b√†o l√† m·ªôt qu√° tr√¨nh sinh h·ªçc m√† ·ªü ƒë√≥, t·ª´ m·ªôt t·∫ø b√†o ban ƒë·∫ßu, sau m·ªói l·∫ßn ph√¢n b√†o th√¨ t·∫ø b√†o ƒë√≥ ƒë∆∞·ª£c t√°ch th√†nh hai t·∫ø b√†o m·ªõi ri√™ng bi·ªát. C√°c t·∫ø b√†o m·ªõi ƒë√≥ l·∫°i ti·∫øp t·ª•c ph√¢n b√†o ƒë·ªÉ t·∫°o ra nh·ªØng t·∫ø b√†o m·ªõi. T·ª´ m·ªôt t·∫ø b√†o n·∫•m m·ªëc, sau 6 l·∫ßn ph√¢n b√†o s·∫Ω t·∫°o ra bao nhi√™u t·∫ø b√†o?",
"a": "64"
},
{
"part": "Ph·∫ßn III: C√¢u tr·∫Øc nghi·ªám tr·∫£ l·ªùi ng·∫Øn",
"type": "short-answer",
"question": "Ng∆∞·ªùi ta tr·ªìng  $2145$  c√¢y theo h√¨nh m·ªôt tam gi√°c nh∆∞ sau: h√†ng th·ª© nh·∫•t c√≥  $1$  c√¢y, h√†ng th·ª© hai c√≥  $2$  c√¢y, h√†ng th·ª© ba c√≥ 3 c√¢y,‚Ä¶ H·ªèi c√≥ t·∫•t c·∫£ bao nhi√™u h√†ng c√¢y?",
"a": "65"
}
];
let quizData = [];
const totalQuestions = originalQuizData.length;
document.getElementById("total-questions-display").textContent = totalQuestions;

// ========== Tr·∫°ng th√°i thi ==========
let currentUser = null;
let quizStartTime = null;
let timerInterval = null;
let timeLeftSeconds = TIME_LIMIT_SECONDS;
let currentQuestionIndex = 0;
let userAnswers = new Array(totalQuestions).fill(null);

// === Utility ===
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}
function prepareShuffledQuiz() {
    // Gi·ªØ ph√¢n lo·∫°i theo 'part' gi·ªëng g·ªëc, nh∆∞ng shuffle trong m·ªói part
    const grouped = originalQuizData.reduce((acc, q) => {
        acc[q.part] = acc[q.part] || [];
        acc[q.part].push(q);
        return acc;
    }, {});
    let res = [];
    for (const part in grouped) {
        shuffleArray(grouped[part]);
        res = res.concat(grouped[part]);
    }
    return res;
}

// ========== Ki·ªÉm tra s·ªë l·∫ßn thi tr∆∞·ªõc khi v√†o ==========
startBtn.addEventListener("click", async () => {
    const now = new Date();
    const startDate = new Date(START_TIME);
    const endDate = new Date(DEADLINE);

    if (now < startDate) {
        alert(`B√†i ki·ªÉm tra ch·ªâ m·ªü t·ª´ ${startDate.toLocaleString('vi-VN')}. Vui l√≤ng quay l·∫°i sau.`);
        return;
    }
    if (now > endDate) {
        alert(`B√†i ki·ªÉm tra ƒë√£ k·∫øt th√∫c v√†o l√∫c ${endDate.toLocaleString('vi-VN')}. Kh√¥ng th·ªÉ nh·∫≠n th√™m b√†i l√†m.`);
        return;
    }

    const studentId = document.getElementById("studentId").value.trim();
    const fullname = document.getElementById("fullname").value.trim();
    const className = document.getElementById("className").value.trim();
    const school = document.getElementById("schoolInput").value.trim();


    if (!studentId || !fullname || !className || !school) {
        alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!");
        return;
    }

    // Ki·ªÉm tra s·ªë l·∫ßn l√†m b√†i v·ªõi Firestore
    try {
        const resultsRef = collection(db, "quizResults");
        const q = query(resultsRef,
            where("studentId", "==", studentId),
            where("examCode", "==", EXAM_CODE),
            where("quizId", "==", QUIZ_ID)
        );
        const snapshot = await getDocs(q);
        if (snapshot.size >= ATTEMPT_LIMIT) {
            alert(`S·ªë b√°o danh ${studentId} ƒë√£ h·∫øt s·ªë l∆∞·ª£t l√†m b√†i (${ATTEMPT_LIMIT} l·∫ßn).`);
            return;
        }
    } catch (err) {
        console.error("L·ªói ki·ªÉm tra l∆∞·ª£t thi:", err);
        alert("L·ªói ki·ªÉm tra s·ªë l∆∞·ª£t thi. Vui l√≤ng th·ª≠ l·∫°i ho·∫∑c ki·ªÉm tra k·∫øt n·ªëi.");
        return;
    }

    // l∆∞u th√¥ng tin t·∫°m v√† hi·ªán modal qu·∫£ng c√°o
    currentUser = { examCode: EXAM_CODE, studentId, fullname, className, school };
    announcementModal.classList.remove("hidden");
});

// ========== V√†o thi sau modal ==========
enterQuizBtn.addEventListener("click", () => {
    announcementModal.classList.add("hidden");
    userInfoSection.classList.add("hidden");
    quizSection.classList.remove("hidden");

    // chu·∫©n b·ªã ƒë·ªÅ, bi·∫øn tr·∫°ng th√°i
    quizData = prepareShuffledQuiz();
    userAnswers = new Array(totalQuestions).fill(null);
    currentQuestionIndex = 0;
    quizStartTime = Date.now();
    timeLeftSeconds = TIME_LIMIT_SECONDS;

    renderNavPanel();
    jumpToQuestion(0);
    startTimer();
});

exitBtn.addEventListener("click", () => {
    announcementModal.classList.add("hidden");
});

// ========== Timer l√†m b√†i ==========
function startTimer() {
    // hi·ªÉn th·ªã l·∫ßn ƒë·∫ßu
    updateTimerDisplay(timeLeftSeconds);

    // clear n·∫øu c√≤n
    if (timerInterval) clearInterval(timerInterval);

    timerInterval = setInterval(() => {
        timeLeftSeconds--;
        if (timeLeftSeconds <= 0) {
            clearInterval(timerInterval);
            // t·ª± ƒë·ªông n·ªôp m√† KH√îNG hi·ªÉn th·ªã confirm
            alert("‚è∞ H·∫øt gi·ªù! B√†i thi s·∫Ω ƒë∆∞·ª£c n·ªôp t·ª± ƒë·ªông.");
            submitQuiz(true); // auto = true
        } else {
            updateTimerDisplay(timeLeftSeconds);
        }
    }, 1000);
}
function updateTimerDisplay(seconds) {
    const min = Math.floor(seconds / 60).toString().padStart(2, '0');
    const sec = (seconds % 60).toString().padStart(2, '0');
    timerElement.textContent = `${min}:${sec}`;
}

// ========== ƒêi·ªÅu h∆∞·ªõng c√¢u h·ªèi ==========
function renderNavPanel() {
    questionNavPanel.innerHTML = '';
    for (let i = 0; i < totalQuestions; i++) {
        const btn = document.createElement('button');
        btn.textContent = i + 1;
        btn.className = 'nav-btn w-10 h-10 border rounded font-medium';
        btn.type = 'button';
        btn.onclick = () => {
            saveCurrentAnswer();
            jumpToQuestion(i);
        };
        questionNavPanel.appendChild(btn);
    }
}
function jumpToQuestion(index) {
    currentQuestionIndex = index;
    showQuestion();
    updateNavPanel();
}
function showQuestion() {
    const q = quizData[currentQuestionIndex];
    document.getElementById("quiz-part-title").textContent = q.part || "";
    document.getElementById("question-counter").textContent = currentQuestionIndex + 1;
    document.getElementById("question-text").innerHTML = q.question || "";
    answerContainer.innerHTML = "";

    switch (q.type) {
        case 'mcq': renderMCQ(q); break;
        case 'true-false': renderTrueFalse(q); break;
        case 'short-answer': renderShortAnswer(q); break;
        default: renderMCQ(q);
    }

    if (window.MathJax && MathJax.typesetPromise) {
        MathJax.typesetPromise();
    }

    prevBtn.classList.toggle('hidden', currentQuestionIndex === 0);
    nextBtn.classList.toggle('hidden', currentQuestionIndex === totalQuestions - 1);
}
function updateNavPanel() {
    const navs = questionNavPanel.children;
    for (let i = 0; i < navs.length; i++) {
        navs[i].classList.remove('nav-btn-current', 'nav-btn-answered');
        if (userAnswers[i] !== null) navs[i].classList.add('nav-btn-answered');
        if (i === currentQuestionIndex) navs[i].classList.add('nav-btn-current');
    }
}

// ========== L∆∞u ƒë√°p √°n khi chuy·ªÉn c√¢u ==========
function saveCurrentAnswer() {
    const q = quizData[currentQuestionIndex];
    if (!q) return;
    let ans = null;
    switch (q.type) {
        case 'mcq':
            const sr = quizForm.querySelector(`input[name="q${currentQuestionIndex}"]:checked`);
            if (sr) ans = sr.value;
            break;
        case 'true-false':
            ans = [];
            for (let i = 0; i < q.s.length; i++) {
                const sr2 = quizForm.querySelector(`input[name="q${currentQuestionIndex}s${i}"]:checked`);
                ans.push(sr2 ? (sr2.value === 'true') : null);
            }
            if (ans.every(x => x === null)) ans = null;
            break;
        case 'short-answer':
            const inp = quizForm.querySelector(`input[name="q${currentQuestionIndex}"]`);
            if (inp && inp.value.trim() !== "") ans = inp.value.trim();
            break;
    }
    userAnswers[currentQuestionIndex] = ans;
    updateNavPanel();
}

// ========== Render c√°c lo·∫°i c√¢u h·ªèi ==========
function renderMCQ(question) {
    const saved = userAnswers[currentQuestionIndex];
    const options = [...question.o];
    options.forEach(option => {
        const div = document.createElement('div');
        const label = document.createElement('label');
        label.className = "flex items-center p-3 rounded-lg border cursor-pointer hover:bg-gray-50";

        const radio = document.createElement('input');
        radio.type = 'radio';
        radio.name = `q${currentQuestionIndex}`;
        radio.value = option;
        radio.className = 'mr-3';
        if (saved === option) {
            radio.checked = true;
            label.classList.add('mcq-label-selected');
        }
        radio.addEventListener('change', () => {
            answerContainer.querySelectorAll('label').forEach(l => l.classList.remove('mcq-label-selected'));
            label.classList.add('mcq-label-selected');
            saveCurrentAnswer();
        });

        const span = document.createElement('span');
        span.innerHTML = option;

        label.appendChild(radio);
        label.appendChild(span);
        div.appendChild(label);
        answerContainer.appendChild(div);
    });
}

function renderTrueFalse(question) {
    const saved = userAnswers[currentQuestionIndex] || [];
    question.s.forEach((st, sIndex) => {
        const div = document.createElement('div');
        div.className = 'flex items-center justify-between p-3 border rounded-lg';

        const span = document.createElement('span');
        span.innerHTML = st.text;

        const group = document.createElement('div');
        group.className = 'flex gap-4';

        const trueLabel = document.createElement('label');
        trueLabel.className = 'cursor-pointer flex items-center';
        const tRadio = document.createElement('input');
        tRadio.type = 'radio';
        tRadio.name = `q${currentQuestionIndex}s${sIndex}`;
        tRadio.value = 'true';
        tRadio.className = 'mr-2';
        if (saved[sIndex] === true) tRadio.checked = true;
        tRadio.addEventListener('change', saveCurrentAnswer);
        trueLabel.appendChild(tRadio);
        trueLabel.append(' ƒê√∫ng');

        const falseLabel = document.createElement('label');
        falseLabel.className = 'cursor-pointer flex items-center';
        const fRadio = document.createElement('input');
        fRadio.type = 'radio';
        fRadio.name = `q${currentQuestionIndex}s${sIndex}`;
        fRadio.value = 'false';
        fRadio.className = 'mr-2';
        if (saved[sIndex] === false) fRadio.checked = true;
        fRadio.addEventListener('change', saveCurrentAnswer);
        falseLabel.appendChild(fRadio);
        falseLabel.append(' Sai');

        group.appendChild(trueLabel);
        group.appendChild(falseLabel);
        div.appendChild(span);
        div.appendChild(group);
        answerContainer.appendChild(div);
    });
}

function renderShortAnswer(question) {
    const saved = userAnswers[currentQuestionIndex] || '';
    const input = document.createElement('input');
    input.type = 'text';
    input.name = `q${currentQuestionIndex}`;
    input.className = 'w-full border rounded px-3 py-2 mt-2';
    input.placeholder = "Nh·∫≠p ƒë√°p √°n";
    input.value = saved;
    input.addEventListener('input', saveCurrentAnswer);
    answerContainer.appendChild(input);
}

// ========== ƒêi·ªÅu khi·ªÉn prev/next ==========
prevBtn.addEventListener('click', () => {
    saveCurrentAnswer();
    if (currentQuestionIndex > 0) jumpToQuestion(currentQuestionIndex - 1);
});
nextBtn.addEventListener('click', () => {
    saveCurrentAnswer();
    if (currentQuestionIndex < totalQuestions - 1) jumpToQuestion(currentQuestionIndex + 1);
});

// ========== X·ª≠ l√Ω n·ªôp b√†i (c√≥ modal confirm) ==========
let isAutoSubmit = false; // n·∫øu g·ªçi b·ªüi timeout th√¨ true

quizForm.addEventListener("submit", (e) => {
    e.preventDefault();
    // N·∫øu ƒëang auto-submit do h·∫øt gi·ªù th√¨ submit ngay
    if (isAutoSubmit) {
        isAutoSubmit = false;
        submitQuiz(true);
        return;
    }
    // else show confirm modal
    confirmSubmitModal.classList.remove('hidden');
});

// khi user x√°c nh·∫≠n Yes
confirmYes.addEventListener('click', () => {
    confirmSubmitModal.classList.add('hidden');
    submitQuiz(false);
});
confirmNo.addEventListener('click', () => {
    confirmSubmitModal.classList.add('hidden');
    // kh√¥ng n·ªôp
});

// submitQuiz th·ª±c t·∫ø (auto=true khi do h·∫øt gi·ªù)
async function submitQuiz(auto = false) {
    // l∆∞u answer hi·ªán t·∫°i
    saveCurrentAnswer();
    if (timerInterval) clearInterval(timerInterval);

    // t√≠nh th·ªùi gian l√†m b√†i
    const timeTakenSeconds = Math.round((Date.now() - quizStartTime) / 1000);
    // tinhdiem 
    let totalScore = 0;
    const answersToSave = {};
    quizData.forEach((q, idx) => {
        const ua = userAnswers[idx];
        answersToSave[`q${idx+1}`] = ua;
        if (ua === null) return;
        switch (q.type) {
            case 'mcq':
                if (ua === q.a) totalScore += 0.5;
                break;
            case 'true-false':
                let correctCount = 0;
                q.s.forEach((st, sIndex) => { if (ua[sIndex] === st.a) correctCount++; });
                const pointsMap = [0, 0.1, 0.25, 0.5, 1];
                totalScore += pointsMap[correctCount] || 0;
                break;
            case 'short-answer':
                if (typeof ua === 'string' && ua.toLowerCase() === String(q.a).toLowerCase()) totalScore += 0.5;
                break;
        }
    });

    // ·∫©n quiz, hi·ªán k·∫øt qu·∫£
    quizSection.classList.add('hidden');
    resultSection.classList.remove('hidden');
    document.getElementById("studentNameResult").textContent = currentUser.fullname || "";

    document.getElementById("finalScore").textContent = totalScore.toFixed(2);

    // l∆∞u l√™n Firestore
    try {
        await addDoc(collection(db, "quizResults"), {
            ...currentUser,
            quizId: QUIZ_ID,
            examCode: EXAM_CODE,
            score: parseFloat(totalScore.toFixed(2)),
            totalPossibleScore: totalQuestions * 0.5, // gi·∫£ s·ª≠ m·ªói c√¢u 0.5 max
            timeTaken: timeTakenSeconds,
            answers: answersToSave,
            submittedAt: serverTimestamp()
        });
    } catch (err) {
        console.error("L·ªói khi l∆∞u k·∫øt qu·∫£:", err);
        alert("ƒê√£ c√≥ l·ªói khi l∆∞u k·∫øt qu·∫£. Vui l√≤ng th·ª≠ l·∫°i ho·∫∑c li√™n h·ªá qu·∫£n tr·ªã.");
    }
}

// N·∫øu timer h·∫øt gi·ªù g·ªçi submitQuiz(true)
function autoSubmitNow() {
    isAutoSubmit = true;
    quizForm.requestSubmit(); // s·∫Ω trigger submit listener v√† auto x·ª≠ l√Ω
}

// ========== Kh·ªüi t·∫°o v√πng answerContainer tham chi·∫øu ==========
const answerContainer = document.getElementById("answer-container");
const questionNavPanel = document.getElementById("questionNavPanel");

// === khi ƒë√≥ng trang d·ªçn d·∫πp ===
window.addEventListener('beforeunload', () => {
    if (timerInterval) clearInterval(timerInterval);
});
// ====== T·ª± ƒë·ªông l·∫•y th√¥ng tin h·ªçc sinh t·ª´ Google Sheet ======
const studentIdInput = document.getElementById("studentId");
const fullnameInput = document.getElementById("fullname");
const classNameInput = document.getElementById("className");

const API_URL = "https://script.google.com/macros/s/AKfycbxyg8Vvc7BO9kAl_K0OJ488Xxx6C-tG_CXaxx44owA/dev"; // ƒë·ªïi link n√†y th√†nh link web app b·∫°n deploy

studentIdInput.addEventListener("blur", async () => {
    const id = studentIdInput.value.trim();
    if (!id) return;

    try {
        const res = await fetch(`${API_URL}?id=${id}`);
        const data = await res.json();

        if (data && data.studentId) {
            fullnameInput.value = data.fullname || "";
            classNameInput.value = data.className || "";
            schoolSelect.value = data.school || "";
            schoolInput.value = data.school || "";

            if (!schoolSelect.querySelector(`option[value="${data.school}"]`)) {
                schoolSelect.value = "Kh√°c";
                schoolInput.classList.remove("hidden");
            } else {
                schoolInput.classList.add("hidden");
            }
        } else {
            alert("‚ùå Kh√¥ng t√¨m th·∫•y s·ªë b√°o danh n√†y trong danh s√°ch.");
        }
    } catch (err) {
        console.error("L·ªói l·∫•y d·ªØ li·ªáu:", err);
        alert("L·ªói k·∫øt n·ªëi t·ªõi Google Sheet. Vui l√≤ng th·ª≠ l·∫°i.");
    }
});
</script>
</body>
</html>

